# RePage PDF - Apache Reverse Proxy Configuration Example
# Copy this file to repagepdf.conf and edit the placeholders
#
# Placeholders to replace:
#   YOUR_DOMAIN         - Your domain name (e.g., repagepdf.example.com)
#   YOUR_CERT_PATH      - Path to SSL certificate (e.g., /etc/letsencrypt/live/example.com)

# HTTP -> HTTPS redirect
<VirtualHost *:80>
    ServerName YOUR_DOMAIN

    # Redirect all HTTP to HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</VirtualHost>

# HTTPS configuration
<VirtualHost *:443>
    ServerName YOUR_DOMAIN

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile YOUR_CERT_PATH/fullchain.pem
    SSLCertificateKeyFile YOUR_CERT_PATH/privkey.pem

    # Proxy settings
    ProxyPreserveHost On
    ProxyRequests Off

    # WebSocket support for Next.js HMR (development)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/?(.*) ws://127.0.0.1:3013/$1 [P,L]

    # Backend API proxy
    ProxyPass /api http://127.0.0.1:8018/api
    ProxyPassReverse /api http://127.0.0.1:8018/api

    # Frontend proxy (everything else)
    ProxyPass / http://127.0.0.1:3013/
    ProxyPassReverse / http://127.0.0.1:3013/

    # Headers
    RequestHeader set X-Forwarded-Proto "https"
    RequestHeader set X-Forwarded-Host "YOUR_DOMAIN"

    # Logging
    ErrorLog /var/log/httpd/repagepdf_error.log
    CustomLog /var/log/httpd/repagepdf_access.log combined
</VirtualHost>
