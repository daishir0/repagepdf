# 業務フロー図

## 概要
RePage PDFは、行政・公益サイトのPDFファイルをそのサイトのデザインに合ったHTMLコードに変換するAIシステムです。
本ドキュメントでは、現行のPDF公開業務と、RePage PDF導入後の業務フローを定義します。

## ステータス
- **フェーズ**: 要件定義
- **作成日**: 2025-12-12
- **更新日**: 2025-12-12
- **作成者**: Claude (AIPM)
- **レビュー状況**: 承認済み

---

## 内容

### 現行業務フロー (As-Is)

行政・公益サイトにおけるPDF公開の現状フロー

```mermaid
flowchart TD
    A[PDF資料作成] --> B[PDF形式で保存]
    B --> C[CMSにPDFアップロード]
    C --> D[リンクのみ掲載]
    D --> E[利用者がPDFダウンロード]
    E --> F{スマホで閲覧?}
    F -->|Yes| G[読みにくい・操作困難]
    F -->|No| H[PC表示で閲覧]
    G --> I[利用者の不満・離脱]
    H --> J[検索エンジンに引っかかりにくい]
```

**現行フローの課題:**
- スマホでの閲覧性が悪い
- サイト内検索・Google検索でヒットしにくい
- JIS X 8341-3（アクセシビリティ）未対応
- HTML化は工数・予算的に困難

### 将来業務フロー (To-Be)

RePage PDF導入後の業務フロー

```mermaid
flowchart TD
    subgraph 初期設定["初期設定（1回のみ）"]
        T1[管理者ログイン] --> T2[テンプレート作成画面]
        T2 --> T3[テンプレート名入力]
        T3 --> T4[学習用URL 3件入力]
        T4 --> T5[AIがサイトのコーディングルールを学習]
        T5 --> T6[テンプレート生成・保存]
    end

    subgraph 変換作業["日常の変換作業"]
        A[PDF資料準備] --> B[RePage PDFにログイン]
        B --> C[変換画面でテンプレート選択]
        C --> D[PDFファイルをアップロード]
        D --> E[PDFコンバーターで解析]
        E --> F[AIがHTML生成]
        F --> G[比較画面表示]
    end

    subgraph 確認承認["確認・承認"]
        G --> H{PDF vs HTML比較確認}
        H -->|修正必要| I[手動で微修正]
        I --> H
        H -->|OK| J[承認ボタン押下]
    end

    subgraph 出力["出力・活用"]
        J --> K{出力方法選択}
        K -->|コピー| L[クリップボードにコピー]
        K -->|ダウンロード| M[HTMLファイル保存]
        K -->|WordPress投稿| N[API経由で投稿]
        L --> O[CMS等に貼り付け]
        M --> P[サーバーにアップロード]
        N --> Q[WordPressで公開]
    end

    T6 --> A
    O --> R[レスポンシブなWebページとして公開]
    P --> R
    Q --> R
    R --> S[利用者がスマホ・PCで快適に閲覧]
```

### MVP（Phase1）スコープのフロー

Phase1で実装する範囲を明示

```mermaid
flowchart TD
    subgraph MVP["Phase1: MVP スコープ"]
        A[管理者ログイン] --> B[テンプレート作成]
        B --> C[URL学習・ルール生成]
        C --> D[PDF変換画面]
        D --> E[PDFアップロード]
        E --> F[HTML生成]
        F --> G[PDF vs HTML 比較表示]
        G --> H[承認]
        H --> I[HTMLダウンロード]
    end

    subgraph Phase2["Phase2: 将来スコープ"]
        J[対話型チューニング]
        K[WordPress API連携]
        L[変換履歴管理・再編集]
    end

    style MVP fill:#e1f5fe
    style Phase2 fill:#fff3e0
```

### 関係者・役割

| 関係者 | 役割 | 責任範囲 |
|--------|------|----------|
| システム管理者 | PDFコンバーター設定、システム全体管理 | コンバーターの追加・切替、ユーザー管理 |
| 変換作業者（職員等） | PDF→HTML変換作業 | テンプレート選択、PDF変換、確認・承認 |
| 利用者（一般市民等） | 変換後Webページの閲覧 | ー（受益者） |

### PDFコンバーター切替アーキテクチャ

```mermaid
flowchart LR
    subgraph Input["入力"]
        PDF[PDFファイル]
    end

    subgraph Converter["PDFコンバーター（切替可能）"]
        C1[PyMuPDF]
        C2[pdfplumber]
        C3[OpenAI Vision API]
        C4[Claude Vision API]
        C5[将来追加エンジン]
    end

    subgraph Config["管理画面で選択"]
        CFG[使用コンバーター設定]
    end

    subgraph Output["出力"]
        OUT[抽出データ]
    end

    PDF --> CFG
    CFG --> C1
    CFG --> C2
    CFG --> C3
    CFG --> C4
    CFG --> C5
    C1 --> OUT
    C2 --> OUT
    C3 --> OUT
    C4 --> OUT
    C5 --> OUT
```

---

## 変更履歴
| 日付 | 版 | 変更内容 | 変更者 |
|------|-----|----------|--------|
| 2025-12-12 | 1.0 | 初版作成 | Claude (AIPM) |

---

## AIレビュー結果
<!-- レビュー実行後に自動追記されます -->
