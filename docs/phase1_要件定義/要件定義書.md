# 要件定義書

## 概要
RePage PDFは、行政・公益サイトのPDFファイルをそのサイトのデザインに合ったHTMLコードに変換するAIシステムです。
本ドキュメントでは、Phase1（MVP）の機能要件・非機能要件を定義します。

## ステータス
- **フェーズ**: 要件定義
- **作成日**: 2025-12-12
- **更新日**: 2025-12-12
- **作成者**: Claude (AIPM)
- **レビュー状況**: 承認済み

---

## 内容

### 1. 業務要件

#### 1.1 背景・課題

**現状の課題:**

| 課題 | 定量的根拠 | 影響 |
|------|-----------|------|
| PDFだらけ問題 | 行政・公益サイトに数百〜数千本のPDFが存在 | 情報アクセシビリティの低下 |
| スマホ閲覧困難 | PDFはレスポンシブ非対応、ピンチズーム必須 | 利用者の不満・離脱 |
| 検索性の低さ | PDFはサイト内検索・Google検索でヒットしにくい | 必要な情報に辿り着けない |
| JIS X 8341-3未対応 | ガイドラインで「HTML化が望ましい」と明記 | アクセシビリティ法令対応の遅れ |
| HTML化コストが膨大 | 1ページあたりのHTML化に外注費数万円 | 予算・人手不足で対応不可能 |

**ターゲットユーザー:**
- 自治体・行政機関・独立行政法人・公益財団法人・社団法人の広報・情報公開担当者
- 行政・公益案件を扱うWeb制作会社（OEM/パートナー候補）

#### 1.2 目的

**誰の:** 行政・公益サイトの運営担当者
**どの課題を:** PDFの閲覧性・検索性・アクセシビリティ問題
**どのように:** AIによる自動HTML変換で
**どれだけ改善するか:** HTML化工数を90%削減し、重要PDFから順次Web化を可能に

#### 1.3 成功指標

| 指標名 | 現状値 | 目標値 | 達成期限 |
|--------|--------|--------|----------|
| PDF→HTML変換工数 | 1PDF=数時間（手作業） | 1PDF=数分（確認作業のみ） | Phase1完了時 |
| 変換精度（テキスト） | - | 95%以上 | Phase1完了時 |
| 変換精度（表・画像） | - | 85%以上 | Phase1完了時 |
| ユーザー満足度 | - | 4.0/5.0以上 | Phase1完了後1ヶ月 |

---

### 2. 機能要件

#### Phase1: MVP スコープ

| 要件ID | 要件名 | 説明 | 優先度 | 備考 |
|--------|--------|------|--------|------|
| FR-001 | ユーザー認証 | メールアドレス/パスワードによるログイン・ログアウト機能 | 必須 | 管理者ロールのみ |
| FR-002 | セッション管理 | ログイン状態の維持、自動ログアウト | 必須 | JWT使用想定 |
| FR-003 | テンプレート作成 | テンプレート名 + 学習用URL 3件を入力し、AIがサイトのコーディングルールを学習・生成 | 必須 | |
| FR-004 | URL学習処理 | 指定URLからHTMLを取得し、CSS/クラス/ID/タグ構造を解析してルール生成 | 必須 | |
| FR-005 | テンプレート一覧 | 作成済みテンプレートの一覧表示 | 必須 | |
| FR-006 | テンプレート削除 | 不要なテンプレートの削除 | 必須 | |
| FR-007 | PDFアップロード | 変換対象のPDFファイルをアップロード | 必須 | 最大ファイルサイズ: 50MB |
| FR-008 | PDF解析 | PDFからテキスト・画像・表を抽出 | 必須 | コンバーター切替対応 |
| FR-009 | 不要要素除外 | ページ番号、ヘッダー/フッター、目次ページ番号等を自動除外 | 必須 | |
| FR-010 | 画像抽出 | PDF内の画像をクリッピングしてファイル化 | 必須 | |
| FR-011 | 表変換 | PDF内の表構造を検出し、HTMLテーブルに変換 | 必須 | |
| FR-012 | HTML生成 | テンプレートルールに従い、抽出コンテンツをHTMLに変換 | 必須 | AI（LLM）使用 |
| FR-013 | 比較画面 | PDFプレビューと生成HTMLを左右に並べて表示 | 必須 | Notionライクなデザイン |
| FR-014 | HTML手動編集 | 生成されたHTMLを画面上で直接編集可能 | 必須 | |
| FR-015 | 承認機能 | 変換結果を承認し確定状態にする | 必須 | |
| FR-016 | HTMLダウンロード | 生成HTMLをファイルとしてダウンロード | 必須 | .html形式 |
| FR-017 | HTMLコピー | 生成HTMLをクリップボードにコピー | 必須 | |
| FR-018 | コンバーター設定 | 使用するPDFコンバーターを管理画面で選択・設定 | 必須 | 切替可能設計 |
| FR-019 | コンバーター切替 | 複数のPDFコンバーターをプラグイン形式で管理 | 必須 | 拡張性重視 |

#### Phase2以降: 将来スコープ（今回は実装しない）

| 要件ID | 要件名 | 説明 | 優先度 | 備考 |
|--------|--------|------|--------|------|
| FR-101 | 対話型チューニング | チャット形式で修正指示を出し、AIが再生成 | 高 | Phase2 |
| FR-102 | WordPress連携 | 生成HTMLをWordPress REST APIで投稿 | 高 | Phase2 |
| FR-103 | 変換履歴管理 | 過去の変換結果を一覧・検索・再編集 | 中 | Phase2 |
| FR-104 | バッチ変換 | 複数PDFの一括変換処理 | 中 | Phase2 |
| FR-105 | マルチユーザー | 複数ユーザーの追加・権限管理 | 低 | Phase3以降 |

---

### 3. 非機能要件

#### 3.1 性能要件

| 項目 | 要件 | 測定方法 |
|------|------|----------|
| レスポンス時間（画面表示） | 2秒以内 | ページロード完了まで |
| PDF変換処理時間 | 10ページPDFで60秒以内 | アップロード〜HTML生成完了まで |
| 同時接続数 | 10ユーザー | 同時ログインユーザー数 |
| 最大PDFサイズ | 50MB / 100ページ | 単一PDFファイル |

#### 3.2 可用性要件

| 項目 | 要件 |
|------|------|
| 稼働率 | 99%（月間停止時間 約7.2時間以内） |
| 計画停止 | 事前通知の上、月1回程度のメンテナンス許容 |
| バックアップ | 日次バックアップ、7日間保持 |

#### 3.3 セキュリティ要件

| 項目 | 要件 |
|------|------|
| 認証方式 | メールアドレス + パスワード認証 |
| 認可方式 | JWTトークンによるセッション管理 |
| 通信暗号化 | HTTPS（TLS 1.2以上） |
| データ暗号化 | パスワードはbcryptでハッシュ化 |
| PDFデータ取扱い | 変換処理後、一定期間で自動削除（個人情報保護対応） |
| APIキー管理 | 環境変数で管理、ソースコードに含めない |

#### 3.4 UI/UXデザイン要件

| 項目 | 要件 |
|------|------|
| デザインテイスト | Notionライクな洗練されたモダンUI |
| レスポンシブ | PC優先（タブレット対応、スマホは参照程度） |
| カラースキーム | 白基調、アクセントカラーは控えめ |
| フォント | システムフォント（Noto Sans JP等） |

#### 3.5 拡張性要件

| 項目 | 要件 |
|------|------|
| PDFコンバーター | プラグイン形式で追加可能な設計 |
| AI/LLMプロバイダ | 将来的にOpenAI/Claude/その他を切り替え可能 |
| 出力先 | 将来的にWordPress以外のCMS連携も追加可能 |

---

### 4. 技術スタック

| レイヤー | 技術 | 備考 |
|----------|------|------|
| インフラ | EC2 Linux (Amazon Linux 2023) | 本番環境 |
| フロントエンド | Next.js (React) | TypeScript使用 |
| バックエンド | Python / FastAPI | 非同期処理対応 |
| データベース | SQLite（標準） / PostgreSQL（切替可能） | 環境変数で切替 |
| ファイルストレージ | ローカルファイルシステム | PDF/画像保存、./storage配下 |
| AI/LLM | OpenAI API / Claude API | 切替可能設計 |

### 5. PDFコンバーター候補

| 種別 | ライブラリ/API | 特徴 | Phase1対応 |
|------|----------------|------|-----------|
| Python | PyMuPDF (fitz) | 高速、テキスト/画像抽出 | 対応 |
| Python | pdfplumber | 表抽出に強い | 対応 |
| Python | pdf2image | ページ画像化 | 対応 |
| Python | Camelot | 表抽出特化 | 検討中 |
| AI API | OpenAI Vision API | 画像認識ベース | 対応 |
| AI API | Claude Vision API | 画像認識ベース | 対応 |
| 外部API | Adobe PDF Services | 高精度だが有料 | Phase2以降 |

---

### 6. 制約条件

| 項目 | 制約 |
|------|------|
| スキャンPDF | OCR精度に依存、品質警告を表示 |
| 複雑なレイアウト | 段組・複雑な図表は手動調整が必要な場合あり |
| 個人情報 | PDFに個人情報が含まれる場合の取り扱いポリシー要検討 |
| LLMコスト | 長大PDF（数十ページ）は分割処理でコスト最適化 |

---

### 7. 用語定義

| 用語 | 定義 |
|------|------|
| テンプレート | 対象サイトのコーディングルール（CSS/タグ構造）を学習した変換ルールセット |
| コンバーター | PDFからテキスト・画像・表を抽出するエンジン |
| 承認 | 変換結果を確認し、出力可能な状態にすること |

---

## 変更履歴
| 日付 | 版 | 変更内容 | 変更者 |
|------|-----|----------|--------|
| 2025-12-12 | 1.0 | 初版作成 | Claude (AIPM) |
| 2025-12-12 | 1.1 | DB: SQLite標準/PostgreSQL切替可能に変更、ストレージ: ローカルに変更 | Claude (AIPM) |

---

## AIレビュー結果
<!-- レビュー実行後に自動追記されます -->
