# 画面設計書

## 概要
RePage PDFシステムのフロントエンド（Next.js/React）の画面詳細設計です。
Phase2の画面一覧・遷移図を基に、各画面のコンポーネント構成、状態管理、API連携を定義します。

## ステータス
- **フェーズ**: 詳細設計
- **作成日**: 2025-12-16
- **更新日**: 2025-12-16
- **作成者**: Claude (AIPM)
- **レビュー状況**: 未着手

---

## 内容

### フロントエンド構成

```
frontend/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── layout.tsx          # ルートレイアウト
│   │   ├── page.tsx            # ダッシュボード
│   │   ├── login/
│   │   │   └── page.tsx
│   │   ├── templates/
│   │   │   ├── page.tsx        # 一覧
│   │   │   ├── new/
│   │   │   │   └── page.tsx    # 作成
│   │   │   └── [id]/
│   │   │       └── page.tsx    # 詳細
│   │   ├── convert/
│   │   │   ├── page.tsx        # 変換
│   │   │   └── [id]/
│   │   │       └── review/
│   │   │           └── page.tsx # 比較・承認
│   │   └── settings/
│   │       └── page.tsx
│   ├── components/
│   │   ├── layout/
│   │   │   ├── Sidebar.tsx
│   │   │   ├── Header.tsx
│   │   │   └── AuthGuard.tsx
│   │   ├── ui/
│   │   │   ├── Button.tsx
│   │   │   ├── Input.tsx
│   │   │   ├── Select.tsx
│   │   │   ├── Card.tsx
│   │   │   ├── Modal.tsx
│   │   │   ├── Toast.tsx
│   │   │   └── Loading.tsx
│   │   ├── templates/
│   │   │   ├── TemplateList.tsx
│   │   │   ├── TemplateForm.tsx
│   │   │   └── TemplateCard.tsx
│   │   ├── conversion/
│   │   │   ├── PdfUploader.tsx
│   │   │   ├── PdfPreview.tsx
│   │   │   ├── HtmlPreview.tsx
│   │   │   ├── HtmlEditor.tsx
│   │   │   └── CompareView.tsx
│   │   └── settings/
│   │       ├── ConverterSelector.tsx
│   │       ├── ModelSelector.tsx
│   │       └── ApiKeyForm.tsx
│   ├── lib/
│   │   ├── api.ts              # APIクライアント
│   │   ├── auth.ts             # 認証ユーティリティ
│   │   └── utils.ts            # 汎用ユーティリティ
│   ├── hooks/
│   │   ├── useAuth.ts
│   │   ├── useTemplates.ts
│   │   ├── useConversion.ts
│   │   └── useSettings.ts
│   ├── stores/
│   │   ├── authStore.ts        # Zustand
│   │   └── uiStore.ts
│   └── styles/
│       └── globals.css         # Tailwind CSS
└── package.json
```

---

### 画面詳細設計

#### SCR-001: ログイン画面

**URL**: `/login`

**コンポーネント構成**:
```
LoginPage
├── Logo
├── LoginForm
│   ├── EmailInput
│   ├── PasswordInput
│   ├── ErrorMessage
│   └── SubmitButton
└── Footer
```

**状態管理**:
```typescript
interface LoginState {
  email: string;
  password: string;
  isLoading: boolean;
  error: string | null;
}
```

**API連携**:
| アクション | API | 成功時 | 失敗時 |
|-----------|-----|--------|--------|
| ログイン | POST /auth/login | ダッシュボードへ遷移 | エラー表示 |

**バリデーション**:
| フィールド | ルール |
|-----------|--------|
| email | 必須、メール形式 |
| password | 必須、8文字以上 |

---

#### SCR-002: ダッシュボード

**URL**: `/`

**コンポーネント構成**:
```
DashboardPage
├── Sidebar
├── Header
│   └── UserMenu
├── RecentConversions
│   └── ConversionCard[]
└── QuickActions
    ├── NewConversionButton
    └── NewTemplateButton
```

**状態管理**:
```typescript
interface DashboardState {
  recentConversions: Conversion[];
  isLoading: boolean;
}
```

**API連携**:
| アクション | API | タイミング |
|-----------|-----|-----------|
| 最近の変換取得 | GET /conversions?limit=5 | 初期表示 |

---

#### SCR-003: テンプレート一覧

**URL**: `/templates`

**コンポーネント構成**:
```
TemplatesPage
├── Sidebar
├── Header
├── ActionBar
│   ├── SearchInput
│   ├── StatusFilter
│   └── NewTemplateButton
├── TemplateList
│   └── TemplateCard[]
└── Pagination
```

**状態管理**:
```typescript
interface TemplatesState {
  templates: Template[];
  filter: {
    status: string | null;
    search: string;
  };
  pagination: {
    page: number;
    limit: number;
    total: number;
  };
  isLoading: boolean;
}
```

---

#### SCR-004: テンプレート作成

**URL**: `/templates/new`

**コンポーネント構成**:
```
NewTemplatePage
├── Sidebar
├── Header
├── TemplateForm
│   ├── NameInput
│   ├── Url1Input (必須)
│   ├── Url2Input (任意)
│   ├── Url3Input (任意)
│   ├── UrlPreview[]
│   └── ActionButtons
│       ├── CancelButton
│       └── CreateButton
└── Toast
```

**バリデーション**:
| フィールド | ルール |
|-----------|--------|
| name | 必須、200文字以内 |
| url1 | 必須、URL形式 |
| url2 | URL形式（入力時） |
| url3 | URL形式（入力時） |

---

#### SCR-005: テンプレート詳細

**URL**: `/templates/{id}`

**コンポーネント構成**:
```
TemplateDetailPage
├── Sidebar
├── Header
├── TemplateInfo
│   ├── NameDisplay
│   ├── StatusBadge
│   ├── UrlList
│   │   ├── UrlItem (url1)
│   │   ├── UrlItem (url2)
│   │   └── UrlItem (url3)
│   ├── CreatedAt
│   └── UpdatedAt
├── LearnedRulesPreview (status=ready時のみ)
│   └── JsonViewer
├── ErrorMessage (status=error時のみ)
├── ActionBar
│   ├── BackButton
│   ├── LearnButton (status=pending時)
│   ├── ReLearnButton (status=ready/error時)
│   └── DeleteButton
└── Toast
```

**状態管理**:
```typescript
interface TemplateDetailState {
  template: Template | null;
  isLoading: boolean;
  isDeleting: boolean;
  isLearning: boolean;
}
```

**API連携**:
| アクション | API | 成功時 | 失敗時 |
|-----------|-----|--------|--------|
| 詳細取得 | GET /templates/{id} | テンプレート表示 | 404エラー表示 |
| 学習実行 | POST /templates/{id}/learn | status更新、ポーリング開始 | エラー表示 |
| 削除 | DELETE /templates/{id} | 一覧へ遷移 | エラー表示 |

---

#### SCR-006: 変換画面

**URL**: `/convert`

**コンポーネント構成**:
```
ConvertPage
├── Sidebar
├── Header
├── StepIndicator (1. テンプレート選択 → 2. PDF選択 → 3. 変換)
├── TemplateSelector
│   └── TemplateDropdown (status=ready のみ)
├── PdfUploader
│   ├── DropZone
│   ├── FileInfo
│   └── ProgressBar
└── ConvertButton
```

**状態管理**:
```typescript
interface ConvertState {
  selectedTemplateId: number | null;
  file: File | null;
  uploadProgress: number;
  isUploading: boolean;
  isConverting: boolean;
}
```

**ファイル制約**:
- 最大サイズ: 50MB
- 最大ページ数: 100ページ
- 形式: PDF only

---

#### SCR-007: 比較・承認画面（メイン）

**URL**: `/convert/{id}/review`

**コンポーネント構成**:
```
ReviewPage
├── Sidebar
├── Header
├── CompareView
│   ├── LeftPane (PDF)
│   │   ├── PdfPreview
│   │   └── PageNavigation
│   └── RightPane (HTML)
│       ├── HtmlPreview / HtmlEditor (切替)
│       └── ViewToggle
├── ActionBar
│   ├── BackButton
│   ├── CopyButton
│   ├── DownloadButton
│   └── ApproveButton
└── Toast
```

**状態管理**:
```typescript
interface ReviewState {
  conversion: Conversion;
  currentPage: number;
  totalPages: number;
  isEditMode: boolean;
  editedHtml: string;
  hasChanges: boolean;
  isSaving: boolean;
}
```

**キーボードショートカット**:
| キー | アクション |
|------|----------|
| ← / → | ページ切替 |
| Ctrl+S | 保存 |
| Ctrl+E | 編集モード切替 |

---

#### SCR-008: 設定画面

**URL**: `/settings`

**コンポーネント構成**:
```
SettingsPage
├── Sidebar
├── Header
├── SettingsForm
│   ├── ConverterSection
│   │   └── ConverterRadioGroup
│   ├── ModelSection
│   │   ├── OpenAIModelSelect
│   │   ├── AnthropicModelSelect
│   │   └── VisionWarning (条件表示)
│   ├── ApiKeySection
│   │   ├── OpenAIKeyInput (masked)
│   │   └── AnthropicKeyInput (masked)
│   └── SaveButton
└── Toast
```

**状態管理**:
```typescript
interface SettingsState {
  currentConverter: string;
  openaiModel: string;
  anthropicModel: string;
  openaiApiKey: string;
  anthropicApiKey: string;
  hasChanges: boolean;
  isSaving: boolean;
}
```

---

### 共通コンポーネント詳細

#### Sidebar

```typescript
interface SidebarProps {
  currentPath: string;
}

const menuItems = [
  { icon: Home, label: 'ダッシュボード', path: '/' },
  { icon: FileText, label: 'テンプレート', path: '/templates' },
  { icon: Upload, label: '変換', path: '/convert' },
  { icon: Settings, label: '設定', path: '/settings' },
];
```

#### Toast

```typescript
interface ToastProps {
  type: 'success' | 'error' | 'info';
  message: string;
  duration?: number; // default: 3000ms
}
```

#### Modal

```typescript
interface ModalProps {
  isOpen: boolean;
  title: string;
  onClose: () => void;
  onConfirm?: () => void;
  confirmLabel?: string;
  cancelLabel?: string;
  children: React.ReactNode;
}
```

---

### デザイントークン（Tailwind CSS）

```css
/* colors */
--primary: #2F80ED;
--primary-hover: #1E6FD9;
--background: #FFFFFF;
--surface: #F7F8FA;
--text-primary: #1A1A1A;
--text-secondary: #6B7280;
--border: #E5E7EB;
--success: #10B981;
--error: #EF4444;
--warning: #F59E0B;

/* spacing (8px grid) */
--space-1: 8px;
--space-2: 16px;
--space-3: 24px;
--space-4: 32px;

/* border-radius */
--radius-sm: 4px;
--radius-md: 8px;
--radius-lg: 12px;

/* shadow */
--shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
--shadow-md: 0 1px 3px rgba(0,0,0,0.1);
```

---

## 変更履歴
| 日付 | 版 | 変更内容 | 変更者 |
|------|-----|----------|--------|
| 2025-12-16 | 1.0 | 初版作成 | Claude (AIPM) |

---

## AIレビュー結果

### レビュー実施日: 2025-12-16

### レビュー結果: 合格（修正済み）

### 検出項目と対応:

| # | 項目 | 重要度 | 内容 | 対応 |
|---|------|--------|------|------|
| 1 | SCR-005欠落 | 中 | テンプレート詳細画面（SCR-005）が欠落していた | SCR-005を追加 |

### 確認事項:
- [x] 全8画面（SCR-001〜SCR-008）が定義されている
- [x] Next.js App Routerのディレクトリ構造が明確
- [x] 各画面のコンポーネント階層が定義されている
- [x] TypeScript状態管理インターフェースが定義されている
- [x] API連携が明記されている
- [x] バリデーションルールが定義されている
- [x] デザイントークン（Tailwind CSS）が定義されている
- [x] API設計書のエンドポイントと整合している
